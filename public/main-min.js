const targetId=e=>e.target.id,parentId=e=>e.target.parentElement.id,queryTarget=e=>document.querySelector(e),queryTargetAll=e=>document.querySelectorAll(e),body=()=>document.body,tools=new Tools,validate=new Validate,announce=new Announce,sort=new Sort,scroll=new Scroll;let menu;const page=new Page,date=new Date,server=new Server,form=new Form,lazyload=new Lazyload;Array.prototype.contains=function(e){return this.indexOf(e)>-1};const formInputs=[...queryTargetAll("input"),queryTarget("textarea")];function Announce(){this.events=(async()=>{const e=await server.getEvents();let[t,a,s]=tools.structureApprouchingEvents(e,!0),[r,o,i]=tools.structureApprouchingEvents(e),n="Nästa kurstillfällen: ";r?(page.addInnerOf("#intensiveEventDates",`Nästa kurstillfälle är den ${r}.<br><br>`),n=`${n} Intensiv Jägarexamen, den ${t}.`):page.hideMe("#intensiveEventDates"),i?(page.addInnerOf("#calmEventDates",`Nästa kurstillfälle är den ${i}.<br><br>`),n=`${n} Lugn Jägarexamen, den ${s}.`):page.hideMe("#calmEventDates"),o?(page.addInnerOf("#leadershipEventDates",`Nästa kurstillfälle är den ${o}.<br><br>`),n=`${n} Jaktledarutbildning, den ${a}.`):page.hideMe("#leadershipEventDates"),r&&o?page.addInnerOf("#parallaxInfo",n):page.hideParent("#parallaxInfo")}),this.formSubmissionSuccess=(()=>{page.addButtonSuccess(),form.reset(),tools.throttle(function(){page.removeSuccess(),page.resetTextareaHeight()},3e3)})}function Form(){const e=new XMLHttpRequest,t=queryTarget("#form");this.requestMailing=(e=>validate.isFormValid(e)?attemptDispatch():""),attemptDispatch=(()=>{e.open(t.method,t.action),e.setRequestHeader("Accept","application/json"),e.onreadystatechange=(()=>{e.readyState===XMLHttpRequest.DONE&&200===e.status&&announce.formSubmissionSuccess()}),e.send(new FormData(t))}),this.reset=(()=>{queryTarget("#form").reset(),page.toggleInputFocus()})}function Lazyload(){let e=[...queryTargetAll(".lazy")];loadImage=(e=>e.classList.remove("lazy")),this.load=(()=>{tools.throttle(()=>{e.length||removeObserver(),e=e.filter(e=>validate.isInWindow(e)?loadImage(e):e)},17)}),removeObserver=(()=>{document.removeEventListener("scroll",this.load),window.removeEventListener("resize",this.load),window.removeEventListener("orientationChange",this.load)})}function Menu(){const e=queryTarget("nav");this.toggle=(()=>{e.classList.toggle("open"),validate.isWidthMobile()&&scroll.toggleScroll()}),this.close=(()=>{scroll.enable(),validate.isMenuOpen()&&e.classList.remove("open")}),this.toggleNavbarVisiblity=(e=>{if(!validate.shouldNavbarVisibiltyToggle(e))return;let t=scroll.direction();this.close(),t?this.addNavbarVisible():this.removeNavbarVisible()}),this.toggleNavbarTransparency=(()=>{tools.getScreenHeight()<=750&&scroll.getPositionY()<50?menu.removeNavbarTransparent():menu.addNavbarTransparent()}),this.addNavbarVisible=(()=>e.classList.add("visible")),this.removeNavbarVisible=(()=>e.classList.remove("visible")),this.addNavbarTransparent=(()=>e.classList.add("transparent")),this.removeNavbarTransparent=(()=>e.classList.remove("transparent"))}function Page(){this.removePreloader=(()=>{queryTarget(".loader_bg").classList.add("hidden")}),this.setVerticlePositionOfBody=(e=>body().style.top=`-${e}`),this.removeVerticlePositionOfBody=(()=>body().style.top=""),this.addInnerOf=((e,t)=>{queryTarget(e).innerHTML=t}),this.removeInnerOf=(e=>{queryTarget(e).innerHTML=""}),this.removeOuterOf=(e=>{queryTarget(e).outerHTML=""}),this.hideMe=(e=>queryTarget(e).style.display="none"),this.hideParent=(e=>queryTarget(e).parentElement.style.display="none"),this.toggleArticle=(e=>{e.target.nextElementSibling.classList.toggle("closed"),e.target.children[0].classList.toggle("open")}),this.resizeTextareaToFitContent=(()=>{validate.isWidthMobile()||scroll.keepYPosition(resizeTextarea)}),resizeTextarea=(()=>{this.resetTextareaHeight(),setTextareaHeight(`${queryTarget("#message").scrollHeight}px`)}),this.resetTextareaHeight=(()=>{queryTarget("#message").value?setTextareaHeight(""):setTextareaHeight("40px")}),setTextareaHeight=(e=>queryTarget("#message").style.height=e),this.formFeedback=(e=>{for(let t in e)e[t]?this.inputError(e[t],t):this.inputSuccess(t)}),this.inputSuccess=(e=>{removeInputError(e),queryTarget(`#${e}`).parentElement.classList.add("success")}),this.removeSuccess=(e=>{if(!e)return[...queryTargetAll(".success")].map(e=>e.classList.remove("success"));queryTarget(`#${e}`).parentElement.classList.remove("success")}),this.inputError=((e,t)=>{page.addInnerOf(`#${t}Feedback`,`<i class="fas fa-exclamation-circle"></i> ${e}`),this.removeSuccess(t),queryTarget(`#${t}`).parentElement.classList.add("error")}),removeInputError=(e=>{page.addInnerOf(`#${e}Feedback`,""),queryTarget(`#${e}`).parentElement.classList.remove("error")}),this.addButtonSuccess=(()=>queryTarget("form").classList.add("success")),this.addButtonError=(()=>queryTarget("form").classList.add("error")),this.removeButtonError=(()=>queryTarget("form").classList.remove("error")),this.toggleInputFocus=(e=>{if(!e)return[...queryTargetAll(".focus")].map(e=>e.classList.remove("focus"));e.target.value||(removeInputError(targetId(e)),e.target.parentElement.classList.toggle("focus"))})}function Scroll(){let e,t;this.setOldScroll=(()=>t=this.getPositionY()),this.getPositionY=(()=>window.scrollY),this.toggleScroll=(()=>{validate.isMenuOpen()?this.disable():this.enable()}),this.disable=(()=>{e=this.getPositionY(),page.setVerticlePositionOfBody(e),queryTarget("body").classList.add("stop-scrolling")}),this.enable=(()=>{validate.isScrollingDisabled()&&(page.removeVerticlePositionOfBody(),queryTarget("body").classList.remove("stop-scrolling"),console.log(e),this.scrollToInstantly({top:e}))}),this.direction=(()=>{const e=t>this.getPositionY();return this.setOldScroll(),e}),this.keepYPosition=(t=>{e=this.getPositionY(),t(),this.scrollToInstantly({top:e})}),this.scrollToParameter=(e=>{validate.setIsScrollingManual(!1);let t=queryTarget(e).getBoundingClientRect().top+window.pageYOffset+-120;window.scrollTo({top:t,behavior:"smooth"})}),this.scrollToTop=(()=>window.scrollTo({top:0,behavior:"smooth"})),this.scrollToBottom=(()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})),this.scrollToInstantly=(e=>window.scrollTo(e))}function Server(){this.data,this.fetch=(async()=>{if(!this.data)try{const[e]=await Promise.all([(await fetch("https://wordpress.jakthalland.se/wp-json/wp/v2/events")).json()]);sort.sortData(e)}catch(e){tools.throttle(this.fetch,5e3),console.log(e)}}),this.getEvents=(async()=>(await this.fetch(),Promise.resolve(sort.sortDataByEvent())))}function Sort(){this.sortData=(e=>{server.data={events:[...e].filter(e=>validate.isEventInFuture(e.acf.startDate)).map(e=>({event:e.acf.event,info:{text:e.acf.text,startDate:e.acf.startDate,endDate:e.acf.endDate}})).sort((e,t)=>tools.compareDates(tools.dateStringIntoIntObject(e.info.startDate),tools.dateStringIntoIntObject(t.info.startDate)))}}),this.sortDataByEvent=(()=>[...server.data.events].reduce(([e,t,a,s,r],o)=>"Jägarexamen (Intensiv)"===o.event?[[...e,o],t,a,s,r]:"Jaktledarutbildning"===o.event?[e,[...t,o],a,s,r]:"Jägarexamen (Lugn)"===o.event?[e,t,[...a,o],s,r]:"Jakt helg"===o.event?[e,t,a,[...s,o],r]:[e,t,a,s,[...r,o]],[[],[],[],[],[]]))}function Tools(){let e;const t=["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],a=["jan","feb","mars","april","maj","juni","juli","aug","sep","okt","nov","dec"];this.lastClickTimeStamp=0,this.lastScrollTimeStamp=0,this.DOMContentLoadedTimeStamp,this.setDOMContentLoadedTimeStamp=(e=>this.DOMContentLoadedTimeStamp=e.timeStamp),this.setLastClickTimeStamp=(e=>this.lastClickTimeStamp=e.timeStamp),this.setLastScrollTimeStamp=(e=>this.lastScrollTimeStamp=e.timeStamp),this.timeBetweenLastClickAndScroll=(()=>this.lastScrollTimeStamp-this.lastClickTimeStamp),this.getScreenWidth=(()=>screen.width),this.getScreenHeight=(()=>screen.height),this.throttle=((t,a)=>{this.cancelThrottle(),e=setTimeout(()=>t(),a)}),this.cancelThrottle=(()=>e?clearTimeout(e):""),this.numberToMonth=((e,s)=>s?a[e-1]:t[e-1]),this.dateStringIntoIntObject=(e=>(dateArr=e.split("/"),{date:this.stringToInt(dateArr[0]),month:this.stringToInt(dateArr[1]),year:this.stringToInt(dateArr[2])})),this.getDate=(()=>({date:date.getDate(),month:date.getMonth()+1,year:date.getFullYear()})),this.stringToInt=(e=>parseInt(e)),this.compareDates=((e,t)=>{const a=365*e.year+31*e.month+e.date-(365*t.year+31*t.month+t.date);return 0===a?0:a<0?-1:1}),this.produceDateString=((e,t)=>combineDatesBasedOnMonthAndDate(this.dateStringIntoIntObject(e.info.startDate),this.dateStringIntoIntObject(e.info.endDate),t)),combineDatesBasedOnMonthAndDate=((e,t,a)=>{const s=this.numberToMonth(e.month,a);return e.month===t.month?e.date===t.date?`${e.date} ${s}`:`${e.date}-${t.date} ${s}`:`${e.date} ${s}-${t.date} ${this.numberToMonth(t.month,a)}`}),this.structureApprouchingEvents=(([e,t,a],s)=>[1===e.length?tools.produceDateString(e[0],s):`${tools.produceDateString(e[0])} och ${tools.produceDateString(e[1],s)}`,tools.produceDateString(t[0],s),tools.produceDateString(a[0],s)])}function Validate(){this.isWidthMobile=(()=>tools.getScreenWidth()<1024),this.isWidthMobile=(()=>tools.getScreenWidth()<1024),this.isInWindow=(e=>e.offsetTop<window.innerHeight+window.pageYOffset),this.isFormAnnouncingSuccess=(()=>queryTarget("form").classList.contains("success")),this.isFormAnnouncingError=(()=>queryTarget("form").classList.contains("error")),this.isScrollingDisabled=(()=>queryTarget("body").classList.contains("stop-scrolling")),this.isMenuOpen=(()=>queryTarget("nav").classList.contains("open"));let e=!0;this.setIsScrollingManual=(t=>e=t),this.shouldNavbarVisibiltyToggle=(t=>{if(e&&t.timeStamp-tools.DOMContentLoadedTimeStamp>1500&&tools.timeBetweenLastClickAndScroll()>40)return!0;scroll.setOldScroll(),this.setIsScrollingManual(!0)}),this.isEventInFuture=(e=>{const t=tools.compareDates(tools.getDate(),tools.dateStringIntoIntObject(e));return 0===t||-1===t}),this.isFormValid=(e=>{let t={name:"För- och efternamn",subject:"",email:'Måste innehålla "@" och "."',message:"Du saknar ett meddelande",phone:"Ogiltigt telefonmnummer"};if("submit"===e.type){const a=e.target.elements,s={name:a.name.value.trim(),subject:a.subject.value.trim(),email:a.email.value.trim(),message:a.message.value.trim(),phone:a.phone.value.trim()};for(let e in s)this.isInputValid(s[e],e)&&(t[e]=""),page.formFeedback({[e]:t[e]});for(let e in s)if(t[e])return page.addButtonError(),tools.throttle(page.removeButtonError,3e3),!1;return!0}{id=targetId(e);const a=queryTarget(`#${id}`).value.trim();this.isInputValid(a,id)&&(t[id]=""),page.formFeedback({[id]:t[id]})}}),this.isInputValid=((e,t)=>{if("name"===t&&e.split(" ").length<2)return!1;if("subject"===t&&!e)return!0;if("email"===t){if(2!==e.split("@").length)return!1;if(2!==e.split(".").length||!e.split(".")[1])return!1;if(5!==e.split(/(\W)/).length)return!1}if("phone"===t){if(""===e)return!0;if(!e.match(/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/)&&!e.match(/^\(?[+]?([0-9]{4})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/))return!1}return!!e})}document.addEventListener("DOMContentLoaded",e=>{tools.setDOMContentLoadedTimeStamp(e),(menu=new Menu).toggleNavbarTransparency(),announce.events(),lazyload.load()}),document.addEventListener("click",e=>{const t=targetId(e);"btnMenu"===targetId(e)?menu.toggle():menu.close(),"nav-1"===t&&scroll.scrollToTop(),["thumbnail-1","nav-2","parallax-1"].contains(t)&&scroll.scrollToParameter(".article-1"),["thumbnail-2","nav-3"].contains(t)&&scroll.scrollToParameter(".article-2"),["thumbnail-3","nav-4"].contains(t)&&scroll.scrollToParameter(".article-3"),["nav-5","parallax-2"].contains(t)&&scroll.scrollToParameter(".form"),"logo"===t&&scroll.scrollToTop(),"article"===t&&page.toggleArticle(e),tools.setLastClickTimeStamp(e)}),queryTarget("#form").addEventListener("submit",e=>{if(e.preventDefault(),validate.isFormAnnouncingError())return page.removeButtonError();validate.isFormAnnouncingSuccess()?(page.removeSuccess(),page.resetTextareaHeight(),tools.cancelThrottle()):form.requestMailing(e)}),queryTarget("#form").addEventListener("input",e=>{"message"===targetId(e)&&page.resizeTextareaToFitContent(e),validate.isFormValid(e)}),window.addEventListener("scroll",e=>tools.throttle(function(){lazyload.load(),tools.setLastScrollTimeStamp(e),scroll.getPositionY()>=400&&menu.toggleNavbarVisiblity(e),scroll.getPositionY()>=10&&menu.removeNavbarTransparent(),(validate.isWidthMobile()?scroll.getPositionY()<=10:scroll.getPositionY()<50)&&(menu.addNavbarVisible(),menu.toggleNavbarTransparency())},20)),window.addEventListener("resize",()=>{validate.isWidthMobile()||tools.throttle(menu.close(),20),menu.toggleNavbarTransparency(),lazyload.load()}),window.addEventListener("orientationChange",()=>{menu.toggleNavbarTransparency(),lazyload.load()}),formInputs.map(e=>e.addEventListener("focus",e=>{page.removeButtonError(),page.toggleInputFocus(e)})),formInputs.map(e=>e.addEventListener("blur",e=>{const t=targetId(e);e.target.value||page.toggleInputFocus(e),validate.isInputValid(e.target.value,t)?page.inputSuccess(t):page.removeSuccess(t),e.target.value||page.resizeTextareaToFitContent}));